{{template "header.html" .}}
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
            <ul class="nav nav-sidebar">
                <li>实时</li>
                {{range .aps}}
                <li><a href="/kiteq?apName={{.HostPort}}">{{.HostPort}}</a>
                </li>
                {{end}}
                <li>最近一小时</li>
                {{range .aps}}
                <li><a href="/kiteq/minutechart?apName={{.HostPort}}">{{.HostPort}}</a>
                </li>
                {{end}}
                <li>最近2天</li>
                {{range .aps}}
                <li><a href="/kiteq/hourchart?apName={{.HostPort}}">{{.HostPort}}</a>
                </li>
                {{end}}
            </ul>
        </div>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <table class="table table-bordered">
                <tr>
                    <td colspan="2"> <h3>KiteQServer({{.apName}})</h3></td>
                </tr>
                <tr>
                    <th>包名称</th>
                    <th>实时值</th>
                </tr>

                <tr>
                    <td>系统当前协程数</td>
                    <td>{{.stats.KiteQ.Goroutine}}</td>
                </tr>
                    <tr>
                    <td>投递协程数</td>
                    <td>{{.stats.KiteQ.DeliverGo}}</td>
                </tr>
                <tr>
                    <td>投递消息数量</td>
                    <td>{{.stats.KiteQ.DeliverCount}}</td>
                </tr>
                 <tr>
                    <td>消息总数量</td>
                    <td>{{.stats.KiteQ.MessageCount}}</td>
                </tr>
                <tr><td colspan=2><h3>TOPIC消息量</h3></td></tr>
                {{range $k,$v :=.stats.KiteQ.Topics}}  
                </tr>
                    <tr>
                    <td>{{$k}}</td>
                    <td>{{$v}}</td>
                </tr> 
               {{end}}  
               <tr><td colspan=2><h3>订阅分组</h3></td></tr>
                {{range $k,$v :=.topics2Groups}}  
                </tr>
                <tr>
                    <td>{{$k}}</td>
                    <td>
                        <table>
                            {{range $v}}
                            <tr>
                                <!-- <td>{{.}}&nbsp;&nbsp;<a href="/kiteq/delsub?apName={{$.apName}}&group={{.}}&topic={{$k}}">删除</a></td> -->
                                       <!-- 删除确认框 -->
                                <td>{{.}}&nbsp;&nbsp;<button class="btn btn-danger btn-primary" data-href="/kiteq/delsub?apName={{$.apName}}&group={{.}}&topic={{$k}}" data-toggle="modal" data-target="#myModal_{{.}}_{{$k}}">删除</button></td>
                                <!-- 模态框（Modal） -->
                                <div class="modal fade" id="myModal_{{.}}_{{$k}}" tabindex="-1" role="dialog" 
                                   aria-labelledby="myModalLabel" aria-hidden="true">
                                   <div class="modal-dialog">
                                      <div class="modal-content">
                                         <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" 
                                               aria-hidden="true">×
                                            </button>
                                            <h4 class="modal-title" id="myModalLabel">
                                               是否要删除该订阅分组?
                                            </h4>
                                         </div>
                                          <div class="modal-body">
                                            Topic={{$k}}<br>
                                            GroupId={{.}}
                                          </div>
                                         <div class="modal-footer">
                                            <button type="button" class="btn btn-default" 
                                               data-dismiss="modal">关闭
                                            </button>
                                            <a class="btn btn-danger btn-ok">确认</a>
                                         </div>
                                      </div><!-- /.modal-content -->
                                   </div><!-- /.modal-dialog -->
                                </div><!-- /.modal -->
                                <script type="text/javascript">
                                    $('#myModal_{{.}}_{{$k}}').on('show.bs.modal', function(e) {
                                        $(this).find('.btn-ok').attr('href', $(e.relatedTarget).data('href'));
                                    });
                                </script>
                            </tr>
                            {{end}}
                        </table>
                    </td>
                </tr> 
                {{end}}       
            </table>
        </div>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
         
            <table class="table table-bordered">
                 <tr>
                    <td colspan="3"><h3>NetWork</h3></td>
                </tr>
                <tr>
                    <th>包名称</th>
                    <th>每分钟包数</th>
                    <th>当天累积包数</th>
                </tr>
               <tr>
                    <td>网路读 字节数/包数</td>
                    <td>{{.stats.Network.ReadBytes}}/{{.stats.Network.ReadCount}}</td>
                   <td>-</td>
                </tr>
               <tr>
                <td>网路写 字节数/包数</td>
                <td>{{.stats.Network.WriteBytes}}/{{.stats.Network.WriteCount}}</td>
                <td>-</td>
                </tr>
                <tr>
                    <td>分发协程数</td>
                    <td>{{.stats.Network.DispatcherGo}}</td>
                    <td>-</td>
                </tr>
                    <tr>
                    <td>当前连接数</td>
                    <td>{{.stats.Network.Connections}}</td>
                    <td>-</td>
                </tr>
            </table>
        </div>
    </div>
</div>
{{template "footer.html" .}}